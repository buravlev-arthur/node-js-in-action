# Знакомство c Node

_Node.js_ - неблокирующая, асинхронная управляемая событиями исполнительная платформа JavaScript с мощьной, компактной стандартной библиотекой.
Распространяется в трех версиях: Current (текущая), LTS (с длительной поддержкой) и Nightly (ежедневные).
Основна на движке Google V8 и на стандарте ECMAScript 6 ES6/ES2015.

**Три концепции неблокирующего выполнения**:

- События;
- Асинхронное API;
- Неблокирующий Ввод/Вывод (Например, процесс получения сетевого ресурса не блокирует остальную бизнес-логику. А по завершению загрузки выполняется callback-функция).

Для сетевых и дисковых операций Node использует библиотеку [libuv](https://libuv.org/), которая использует в свою очередь неблокирующие сетевые вызовы и пул потоков операционной системы.

Модуль HTTP-сервера: `http.Server`.

## Цикл событий

**Цикл событий (работает по принципу FIFO (Первый зашёл - первый вышел))**:

1. Таймеры: `SetTimeout` и `SetInterval`;
2. Callback-функции ввода/вывода событий (вызовов), для которых уже вернулся результат;
3. Опрос новых событий ввода/вывода;
4. Обратные вызовы, запланированные функций setImmediate.

## ES2015, Node, V8

**Новые возможности ES2015**:

- Классы
- `const`/`let` вместо `var` для блочной области видимости
- Promises и генераторы ([Koa](https://koajs.com/))
- Строковые шаблоны
- Стрелочные функции (укороченная запись и локальная зона видимости внутри родительских функций)

V8 интепретирует и выполняет JavaScript. Для работы libuv и V8 используется прослойка на C++.

**Категории функциональности возможностей V8**:

- Завершенные (включены по-умолчанию)
- Запланированные (для включения добавляется флаг: `--harmony`)
- В разработке

```bash
# запустить скрипт с запланированными возможностями
node --harmony script.js
# посмотреть список возможностей в разработке
node --v8-options | grep "in progress"
```

Система семантического управления версиями (SemVer):
`[основной номер (major)].[дополнительный номер (minor)].[оперативный номер (patch)]`

## Установка Node

- Установка на Debian (Ubuntu): https://github.com/nodesource/distributions#installation-instructions
- Установка через NVM: https://github.com/nvm-sh/nvm#installing-and-updating
- Все остальные ОС: https://nodejs.org/en/download/package-manager

## Встроенные средства Node

Среда Node включает: интепретатор, менеджер пакетов (npm), базовые модули Node.js, отладчик.

`npm init -y` - создание проекта в текующей дериктории (`-y` - со всем согласиться при установке)
`npm install --save <package name>` - установка пакета
`npm install --global <package name>` - глобальная установка пакета в системе

### Базовые модули

- Библиотеки файловой системы: `fs`, `path`;
- TCP клиент/сервер: `net`;
- HTTP: `http`, `https`;
- Разрешения доменных имен: `dns`;
- Написание тестов: `assert`;
- Библиотека для запросов информации о платформе: `os`;
- Работа с событиями: `events`;
- Работа с потоками данных: `stream`

**Управление потоками данных с помощью функции pipe()**: ./node-js-examples/compress-file.js
**Пример Node-сервера**: ./node-js-examples/server.js

### Отладчик

```bash
# Отладка в консоли
node inspect script.js

# Отладка в браузере
node --inspect --inspect-brk script.js
```

**Три типа Node.js программ**:

- Веб-приложения (SPA, REST и приложения полного стека);
- Приложения командной строки (npm, webpack);
- Демоны (PM2);
- Настольные приложения на базе Electron (Atom, Visual Studio Code);
- Транспиляторы (преобразование TypeScript в JavaScript).

**Пример сервера на Express**: ./express-examples/server.js

`process` - объект, доступный в коде Node и хранящий аргументы, заданные пользователем при запуске программы

**Пример использования process**: ./node-js-examples/cli.js

`#!/usr/bin/env node` - шебанг для запуска программы Node как команды в интепретаторе командрой строки
